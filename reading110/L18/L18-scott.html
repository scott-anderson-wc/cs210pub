<!doctype html>
<!-- Filename: index.html
     Purpose:  Intro Lecture to jQuery
     Author: Eni Mustafaraj and Scott D. Anderson
     Date: Apr 11, 2014
     Updated: April 2015
-->

<html>
  <head>
    <meta charset="utf-8">
    <title>CS110: Intro to jQuery</title>
    <!--#include virtual="/~cs110/modularity/bs-head.part" -->
    <style>
      .price { font-style: italic; }
      .title { font-weight: bold; font-size: bigger; text-decoration: underline; }

      .alice { background-color: LightBlue; width: 100px; margin: 3px; }

      #animals, #clonedAnimals { overflow: hidden; }
      #animals figure, #clonedAnimals figure { float: left; width: 200px; }
      #animals img, #clonedAnimals img { width: 100%; }

    table, th,td {
      border: 1px solid gray;
    }
    td, th {
      padding: 4px 8px;
    }
      </style>
  </head>

  <body>
    <!--#include virtual="/~cs110/modularity/navbar.part" -->
    
    <div class="container">

      <h1>The jQuery Library<small>&nbsp;Write Less, Do More</small></h1>
      <hr>
      
      <div class="row">
      
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">            
              <li><a href="#example">Interactive Example</a>
              <li><a href="#basics">jQuery Basics</a></li>
              <li><a href="#jsVjq">Javascript vs. jQuery</a></li>        
              <li><a href="#methods">Some jQuery Methods</a></li>                         
              <li><a href="#generating-content">Generating Content</a></li>                     
              <li><a href="#cloning">Cloning</a></li>                     
              <li><a href="#data">User-defined Attributes</a></li>                        
            </ul>
          </div>
        </div>
 
      <div class="col-md-8" role="main">
                        <p>jQuery is a library written in Javascript that is specialized for changing 
        web documents on the fly. It is one of the most used libraries on the Web.</p>
       
      <div class="alert alert-info">
      <h2 id="example">Interactive Example</h2> 
      <p>Once you have completed reading these notes and perhaps the book chapter as well, you
        might want to test your learning by trying to add jQuery code to this <a href="jqueryEx_start.html">HTML page</a>, so that you gradually build a page that displays the
        behavior shown <a href="screencast.html">in this screencast</a>. You can
         do so without adding a single line to the HTML or CSS portions, but only with jQuery code.</p> 
      <p>Don't worry if you cannot figure out everything. On Lab this week, you will work on a variation
        of this example.</p>
        </div>
        
      <h2 id="basics">jQuery Basics</h2>
        
      <h4>1. Include jQuery in a webpage</h4>
      <p>In order to use jQuery in a webpage, we need to include it with the <code>&lt;script&gt;</code>
        tag. The library itself is a big Javascript file with hundreds of lines of code. We can either
        download this file from the <a href="http://jquery.com/download/">jQuery website</a>, or
        we can use an absolute URL to some web server that keeps a copy of the library online.
        For simplicity, we will do the latter. Here is how we will include jQuery in our programs:
        
        <pre>
&lt;script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"&gt;&lt;/script&gt;
</pre>
        
        <p>As of this lecture, the most current version of jQuery is 1.11.0. In your reading
        or examples from the Web, you will notice other version numbers. The <code>.min</code>
        part of the filename means <em>mininfied</em>. This refers to the practice of deleting all newlines
          and other space to reduce file size. If you open this file, you'll notice
        that it doesn't show the structure of a normal Javascript program with indentation and
        nesting. Thus, it is not for human consumption. However, it does
        load faster, because the file is smaller.</p>
      
        
        <h4>2. jQuery wrapper</h4>
        <p>Once we have the jQuery library linked to our page, we can start using its main
        method, the <em>jQuery Wrapper</em>. This is a function that has two forms, one
        is more used than the other:
        </p>
<pre class="prettyprint lang-js linenums" style="width: 300px">
// Short form used more often
$()

// Long form  used rarely
jQuery()
</pre>
        
        <p>There are three things we can do with this function, they are listed below in order of most
        common to less common:</p>
        
<pre class="prettyprint lang-js linenums">
// Usage 1: Select elements from the DOM, using CSS selector phrases

$("h1");
$("nav ul li");
$("li:nth-of-type(2)");

// Usage 2: Create new HTML elements on the fly
$("&lt;p&gt;It's a rainy day&lt;/p&gt;").appendTo("body")

// or
$("&lt;p&gt;").text("It's a sunny day")
              .appendTo("body");

// Usage 3: Access elements through their variable names
$(document);
$(this);

var header = $("header");
$(header).append("&lt;h1&gt;Welcome guest!&lt;/p&gt;")
</pre>
        
        <p>Being able to distinguish between these three usages is helpful to understand
        code written by others.</p>
        
    <h4>3. Method Chaining</h4>
        <p>The jQuery wrapper function always returns a value,
        which is an array. Sometimes this array might be empty, sometimes it has one element, and 
        sometimes it has multiple elements.</p>
        
        <p>Knowing that the jQuery wrapper always returns something is very useful for 
          <a href="http://www.w3schools.com/jquery/jquery_chaining.asp">chaining
        jQuery methods</a>. This is done to avoid storing results in temporary variables.
        Here is how an example of <strong>chaining</strong> looks like:</p>
        
<pre class="prettyprint lang-js linenums">
// create a new element and add it to the body tag
$("&lt;p&gt;")
      .text("Just added a new paragraph")     // put some text to this element. No semi-colon
      .css("font-size", "30pt")               // add some style. No semi-colon
      .appendTo("body")                       // append it to the body. Semi-colon here because we are done
</pre>

        <p>The first call to <code>$("p")</code> created a new element and returned it.
        To the returned result, we applied the method <code>text</code>, which set the contents of the paragraph
         and then returned it, so we then applied the <code>css</code> method, which changes the css and also returned the paragraph, so we applied the <code>.appendTo()</code> method to append the paragraph to the body of the document.
          Note that there are no semi-colons until we are all done.

          <p>You don't have to use this technique if you don't want to,
          but it can be very clear to read (once you are used to it) and
          it is commonly used in online tutorials and examples.
        
      <h4>4. Is the DOM ready?</h4>
      <p>An important question is when should our jQuery code be executed. Putting the code
        in different parts of the HTML file might have different effects on the page, based
        on when the browser reads and interprets the code. This is why, normally, the jQuery
        code should be executed only after the DOM has been created and is ready for 
        dynamic manipulation.</p>  
        <p>Most examples you'll see in the provided reading, will show code usually wrapped in a 
          big event handler for the <code>document</code>
        object, as shown below:</p>
        
        <pre>
$(document).ready(function(){

  // all other jQuery code goes here

});
</pre>
        
<p>This code is complex to understand. It uses the jQuery wrapper function with an object,
to the result it applies the method ready() (which is triggered when the DOM is ready),
and to this method it passes as an argument an <a href>anonymous function</a>.  
  Notice that the final line is <code>});</code>.</p>
        
<div class="alert alert-warning">
   <h4>Avoiding <code>$(document).ready(function(){..});</code></h4> 
  <p>Since the syntax for this event handler is complex and difficult to remember,
  we'll use a trick. We will always put our jQuery code at the very end of the HTML 
  file, just before the end tag for <code>body</code>. This way, we know that the 
  previous HTML lines have been already processed by the browser and the DOM is ready.
  </p>
  <p>If you put the jQuery code (or the <code>script</code> tag referring to the jQuery
  code) anywhere else in the HTML file, you'll run into the problem of the DOM not being ready and
  your code will not work.</p>
</div>

<h2 id="jsVjq">Javascript versus jQuery</h2>
<p>After having spent weeks learning Javascript you might ask why use jQuery. The reason is simple,
it allows you to write less code to achieve the same things. jQuery itself is completely written in
Javascript, however, it encapsulates in methods some of the most common activities that one would
have to code and code over again for every program. jQuery is a perfect example of the big ideas
of <strong>abstraction</strong> and <strong>modularity</strong> which are at the heart of computation.</p>

<p>Below is a table of some one-to-one mapping between Javascript code we have seen and jQuery method
calls.</p>

<table>
    <thead>
    <tr>
      <th>Javascript Code</th>
      <th>jQuery Code</th>
    </tr>
    </thead>
    <tbody>
       <tr>
      <td><pre>
document.querySelector("nav ul")        
</pre>
</td>
<td>
<pre>
$("nav ul");
</pre>
</td>
</tr>
             <tr>
      <td><pre>
document.querySelector("h1").innerHTML = "Welcome";     
</pre>
</td>
<td>
<pre>
$("h1").html("Welcome");
</pre>
</td>
</tr>
      
  <tr>
      <td><pre>
function doWhenClicked() {
  // body of function
}
document.querySelector("button").onclick = doWhenClicked;
</pre>
</td>
<td>
<pre>
function doWhenClicked() {
  // body of function
}
$("button").click(doWhenClicked)
</pre>
</td>
</tr>
      
        <tr>
      <td><pre>
document.querySelector("h1").style.color = "red";       
</pre>
</td>
<td>
<pre>
$("h1").css("color", "red")
</pre>
</td>
</tr>
    <tr>

      <td><pre>
 window.onload = onDocumentReady;
 function onDocumentReady() {
     // body of function 
 }
</pre>
</td>
<td>
<pre>
$(document).ready(function(){
  // body of function
});
</pre>
</td>
</tr>
      </tbody>
  </table>
        <br><br>
 <p>As you can notice, all the Javascript examples can be written in less code with jQuery.</p>       
        <h2 id="methods">Some jQuery Methods</h2>
        <p>Here is a list of jQuery methods used in our interactive example or in the 
        <a href="../../assignments/a07/">assignment for this week.</a></p>
        <ul>
          <li>.ready()</li>
          <li>.append()</li>
          <li>.appendTo()</li>
          <li>.click()</li>
          <li>.show()</li>
          <li>.hide()</li>
          <li>.text()</li>
          <li>.attr()</li>
          <li>.val() // for input fields</li>
          <li>.parent()</li>
          <li>.clone()</li>
          <li>.addClass()</li>
          <li>.removeClass()</li>
          <li>.find()</li>
</li>
        </ul>
        <p>To see more examples and explanations for these methods, you should consult the 
        <a href="http://api.jquery.com/">jQuery API documentation</a>.</p>
        
        <h2 id="generating-content">Generating Content</h2>

        <p>One of the things we have used JavaScript for is to dynamically
        add things to the document. For example,
        in <a href="../L15/index.html">the lecture on Arrays and
        Loops</a>, we built a bunch of paragraphs for some books from an
        array of objects describing each book. (We can imagine that this
        array of objects is dynamically loaded from some server, maybe
        from a search request we made.)  Similarly, in the
        associated <a href="../L15/activities.html">class activities on
        arrays and loops</a>, we built a list of thumbnail pictures from
        an array of objects.

        <p>We used two different techniques in these loops.  The first was
        to build up a long string of HTML code:

<div>
<textarea style="width: 100%;" rows=20 cols=80>
var books = [{title: "Mockingjay", price: 4.99},
             {title: "Fahrenheit 451", price: 2.99},
             {title: "Persuasion", price: 1.99},
             {title: "Middlemarch", price: 0.99}];

var html = "<ul>";
for (var i=0; i < books.length; i=i+1){
    var book = books[i];
    var oneLine = "<li>"
                  + " <span class='title'>" + book.title + "</span>"
                  + " <span class='price'>" + book.price + "</span>"
                  + "</li>";
    html = html + oneLine;
}
html += "</ul>";
alert("html is "+html);
var divElement = document.querySelector("#newbooks");
divElement.innerHTML = html;
</textarea><br>
<button onclick="eval(this.parentNode.firstElementChild.value);">Execute it</button> 
<button onclick="$('#newbooks').empty();">clear it</button>
</div>

<p>Try it!

<div style="border: 2px solid blue; padding: 1ex" id="newbooks"></div>

<p>This technique works fine, but the coding is made harder with nested
quotation marks, difficulty balancing angle brackets and tags, and so
forth.  It becomes increasingly difficult as the HTML gets more complex.

  <p>Another technique is to build the HTML elements using
  the <code>document.createElement</code> methods and assemble them that
  way. We used that with the gallery of thumbnails:
    
<div>
<textarea style="font: 10px courier; width: 100%;" rows=27 cols=80>
var images = [
  {alt: "bear",      src: "animals/images/bear.jpg",      title: "The Fishing Bear",    class: "mammal"},
  {alt: "clownfish", src: "animals/images/clownfish.jpg", title: "Nemo's ancestor",     class: "fish"},
  {alt: "swan",      src: "animals/images/swan.jpg",      title: "Swan's lake",         class: "bird"},
  {alt: "cheetahs",  src: "animals/images/cheetahs.jpg",  title: "The prairie's kings", class: "mammal"},
  {alt: "swordfish", src: "animals/images/swordfish.jpg", title: "Swords at the door",  class: "fish"},
  {alt: "pelican",   src: "animals/images/pelican.jpg",   title: "Wings of desire",     class: "bird"},
  {alt: "kangaroo",  src: "animals/images/kangaroo.jpg",  title: "Kangaroo and Joey",   class: "mammal"},
  {alt: "eel",       src: "animals/images/eel.jpg",       title: "Electric Eel",        class: "fish"},
  {alt: "raven",     src: "animals/images/raven.jpg",     title: "Raven at Wellesley",  class: "bird"}
];

var divElement = document.querySelector("#animals");
for (var i=0; i < images.length; i=i+1) {
    obj = images[i];
    var img = document.createElement("img");
    img.setAttribute("src",obj.src);
    img.setAttribute("alt",obj.alt);
    var caption = document.createElement("figcaption");
    caption.innerHTML = obj.title;
    var fig = document.createElement("figure");
    fig.appendChild(img);
    fig.appendChild(caption);                   
    divElement.appendChild(fig);    
}
</textarea><br>
<button onclick="eval(this.parentNode.firstElementChild.value);">Execute it</button> 
<button onclick="$('#animals').empty();">clear it</button>
</div>

<p>Try it!

<div style="border: 2px solid blue; padding: 1ex" id="animals"></div>

<p>The disadvantages of this technique is that it's just tedious,
requiring a new line of code for every attribute, for every element, for
every attachment of one element to another.

  <h2 id="cloning">Cloning</h2>

<p>Today, we'll learn an alternative to both of these techniques for
generating content, called <em>cloning</em>.  The idea of cloning is
pretty straightforward:
  <ul>
    <li>Write some HTML that you want to replicate many times. You can
    debug this in all the usual ways that you're used to from the first
    weeks of this class.
      
    <li>Put it inside a container DIV that you can give an ID and then hide.
      
    <li>In your loop, you can <em>clone</em> this template (making a copy
    of all the elements).  This clone is a tree with all the parent/child
    relationships of the original
      
    <li>You can use the jQuery <code>find</code> method to find elements
    of the clone, and other jQuery methods to modify the elements, filling
    in their attributes.
  </ul>

<p>Let's see it in action. Let's first write the template HTML.  I'll use
the clownfish in the template example:

<pre class="prettyprint lang-html">
&lt;figure&gt;
  &lt;img src="animals/images/clownfish.jpg" alt="clownfish"&gt;
  &lt;figcaption&gt;Nemo's ancestor&lt;/figcaption&gt;
&lt;/figure&gt;
</pre>

<p>Next, I'll put it in a wrapper, so that the template is hidden. (In
practice I would do the hiding in an external CSS file, but I wanted to
show you the CSS here.)

<pre class="prettyprint lang-html">
&lt;div id="template" style="display: none"&gt;
  &lt;figure&gt;
    &lt;img src="animals/images/clownfish.jpg" alt="clownfish"&gt;
    &lt;figcaption&gt;Nemo's ancestor&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;
</pre>
  
<div id="template" style="display: none">
  <figure>
    <img src="animals/images/clownfish.jpg" alt="clownfish">
    <figcaption>Nemo's ancestor</figcaption>
  </figure>
</div>

<p>Now, I'm ready to do my looping and cloning.

<div>
<textarea style="font: 14px courier; width: 100%;" rows=20 cols=80>
var images = [
  {alt: "bear",      src: "animals/images/bear.jpg",      title: "The Fishing Bear"},
  {alt: "clownfish", src: "animals/images/clownfish.jpg", title: "Nemo's ancestor"},
  {alt: "swan",      src: "animals/images/swan.jpg",      title: "Swan's lake"},
  {alt: "cheetahs",  src: "animals/images/cheetahs.jpg",  title: "The prairie's kings"},
  {alt: "swordfish", src: "animals/images/swordfish.jpg", title: "Swords at the door"},
  {alt: "pelican",   src: "animals/images/pelican.jpg",   title: "Wings of desire"},
  {alt: "kangaroo",  src: "animals/images/kangaroo.jpg",  title: "Kangaroo and Joey"},
  {alt: "eel",       src: "animals/images/eel.jpg",       title: "Electric Eel"},
  {alt: "raven",     src: "animals/images/raven.jpg",     title: "Raven at Wellesley"},
];

for (var i=0; i < images.length; i=i+1) {
    obj = images[i];
    var clone = $("#template > figure").clone();
    clone.find("img").attr( "src", obj.src).attr("alt", obj.alt);   // chaining here
    clone.find("figcaption").html(obj.title);
    clone.appendTo("#clonedAnimals");
}
</textarea><br>
<button onclick="eval(this.parentNode.firstElementChild.value);">Execute it</button> 
<button onclick="$('#clonedAnimals').empty();">clear it</button>
</div>

<div style="border: 2px solid blue; padding: 1ex" id="clonedAnimals"></div>

<p>I think you'll agree that code is shorter, easier and more intuitive
than either of the first two.

<p>A few more details:
  <ul>
    <li>You'll note the use of a child selector (<code>#template &gt;
        figure</code>) when we get the thing that we want to clone.  We
        don't want to clone the wrapper (which is hidden and has an id).
      
    <li>Your template and your clones should not use ID, because a ID is
      supposed to be unique.  Instead, use classes.
      
    <li>The argument to <code>.find()</code> is a CSS-style
    selector. Here, we used the names of the elements,
    like <code>img</code> and <code>figcaption</code>. If we were doing
    the books example, where there were several spans, we might have
    used <code>.title</code> and <code>.price</code> as the selectors,
    looking for things with a particular CSS <em>class</em>.
      
    <li>The <code>.find()</code> method can be used in other contexts, of
    course, but it is often used in cloning.

  </ul>


<h2 id="data">User-defined Attributes</h2>

<p>When we create elements, we sometimes want to add some additional
information that doesn't quite fit into the HTML code. For example, on a
e-commerce site, we might want to put
the <a href="http://en.wikipedia.org/wiki/Stock_keeping_unit">SKU</a>
number or bar code on the element, so that we can have that info for
ordering.  

<p>The new HTML5 standard explicitly addresses this by saying that any
element can
have <a href="http://www.w3schools.com/tags/att_global_data.asp">custom
attributes</a> starting with <code>data-</code> and those attributes are
reserved for users. Let's do that in our books example.

<p>First, the template:

<div id="book_template" style="display: none">
  <li><span class="title"></span>, which costs <span class="price"></span>
</div>

<pre class="prettyprint lang-html">
&lt;div id="book_template" style="display: none"&gt;
  &lt;li&gt;&lt;span class="title"&gt;&lt;/span&gt;, which costs &lt;span class="price"&gt;&lt;/span&gt;
&lt;/div&gt;
</pre>  

<p>Now, the code to generate the book list. Note that I added the ISBN-10
data to our objects.  We'll add a click handler so that if you click on a
book, the ISBN-10 is displayed.

<div>
<textarea style="width: 100%;" rows=20 cols=80>
var books = [{title: "Mockingjay", price: 4.99, isbn10: '0545663261'},
             {title: "Fahrenheit 451", price: 2.99, isbn10: '1451673310'},
             {title: "Persuasion", price: 1.99, isbn10: '150329031X'},
             {title: "Middlemarch", price: 0.99, isbn10: '0141439548'}];

var list = $("<ul>");
for (var i=0; i < books.length; i=i+1){
    var book = books[i];
    var clone = $("#book_template > li").clone();
    clone.find(".title").html(book.title);
    clone.find(".price").html(book.price);
    clone.attr("data-isbn10",book.isbn10)
          .click(buy_it)
          .appendTo("#clonedBooks");
}

function buy_it() {
   alert("Please order ISBN-10: "+$(this).attr("data-isbn10"));
}
</textarea><br>
<button onclick="eval(this.parentNode.firstElementChild.value);">Execute it</button> 
<button onclick="$('#clonedBooks').empty();">clear it</button>
</div>

<p>Try it!  Try clicking on one of them, too.

<div style="border: 2px solid blue; padding: 1ex" id="clonedBooks"></div>

<h2 id="hide_show_anon_handler">Hide, Show and Anonymous Functions as Handlers</h2>

<p>A few more fun items to know.

<p>First, we often want to hide something on the page and then reveal it
  later. Like this:

  <div style="border: 2px solid blue; padding: 2ex">
    <button id="hide_it">hide it</button>
    <button id="show_it">show it</button>
    <span id="peeker" style="border: 2px solid green">peeker says peek a boo!</span>
  </div>
    
<p>This can be done by manipulating the CSS.  If an element has
  a <code>display: none</code> property, it won't be displayed, so it's
  hidden. If you change the <code>display</code> property back to what it
  was originally (<code>block</code> for block elements
  and <code>inline</code> for inline elements), the element reappears.

<p>jQuery has methods that do this for us: <code>.hide()</code>
and <code>.show()</code>.

<p>We <em>could</em> define two functions and add them as event handlers
  to the two buttons.  The code would look like this:

  <pre class="pretty-print lang-js">
function hide_peeker () {
    $("#peeker").hide() {
}

function show_peeker () {
    $("#peeker").show();
}

$("#hide_it").click(hide_peeker);
$("#show_it").click(show_peeker);
</pre>

<p>The code is pretty clear, but it's verbose and requires us to make up
  two names for functions. Experienced jQuery programmers use anonymous
  functions like this:

<pre class="pretty-print lang-js">
$("#hide_it").click(function () { $("#peeker").hide(); });
$("#show_it").click(function () { $("#peeker").show(); });
</pre>

<p>Now, there's a punctuation nightmare at the end, but nevertheless, this
  is a nice trick worth knowing.

<p>When you ask jQuery to modify a set of things, it will modify each one
in the set.  This makes it really easy to add the same function as an
event handler to lots of different elements, just by using a CSS selector
that matches more than one thing.  In the following example, we have three
boxes, all with the class <code>alice</code>, and we want them to grow by
25% each time you click on them.  Try it!  (I wanted to
use <code>AliceBlue</code> as the background color, but it's too pale.)

  <div style="border: 2px solid blue; padding: 2ex">
    <div class="alice">I'm Alice 1</div>
    <div class="alice">I'm Alice 2</div>
    <div class="alice">I'm Alice 3</div>
  </div>
    
<p>The jQuery code to do that is here:
  
<pre class="pretty-print lang-js">
  $(".alice").click(function () {
      var w = parseInt($(this).css('width'));
      $(this).animate({'width': w * 1.25});
  });
</pre>

<p>Of course, we could have done that with a named function as well, but
this is almost as easy, and some would say it's easier.  Using the
anonymous function also makes it clear what <code>this</code> refers to,
namely, the Alice that was clicked on.

    </div> <!-- end of col-md-8-->
  </div> <!-- end of row-->

  <!--#include virtual="/~cs110/modularity/footer.part" -->
 </div> <!--end of container>
        
        
 <!--#include virtual="/~cs110/modularity/bs-footer.part" -->
<script>
  $("#show_it").click(function () { $("#peeker").show(); });
  $("#hide_it").click(function () { $("#peeker").hide(); });

  $(".alice").click(function () {
      var w = parseInt($(this).css('width'));
      $(this).animate({'width': w * 1.25});
  });
</script>

</body>
</html>
