<!doctype html>
<!-- Filename: index.html
     Purpose:  Lecture about submitting forms
     Author: Eni Mustafaraj
     Date: Apr 22, 2014
-->

<html>
  <head>
    <meta charset="utf-8">
    <title>CS110: Submitting Forms</title>
    <!--#include virtual="/~cs110/modularity/bs-head.part" -->
    <style>

      </style>
  </head>

  <body>
    <!--#include virtual="/~cs110/modularity/navbar.part" -->
    
    <div class="container">

      <h1>Submitting Forms &nbsp;<small>With Server-Side Scripts</small></h1>
      <hr>
      
      <div class="row">
      
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav"> 
               <li><a href="form">Form Attributes</a></li>
               <li><a href="#php">Processing forms with PHP</a></li>
               <li><a href="#ajax">AJAX</a></li>
               <li><a href="#dedicated_mail">Mail to Predetermined Address</a></li>
            </ul>
          </div>
        </div>
 
      <div class="col-md-8" role="main">
                
      <h2 id="methods">Form Attributes</h2>
      <p>When we introduced forms <a href="../../L09/forms1.html">earlier in the semester</a>,
         we didn't talk about any of the attributes of the <code>&lt;form&gt;</code>
         element. Here is how it will usually look like:</p>
         
         <pre>
&lt;form 
      id = "..."     &lt;!-- <strong>id</strong> is used by the CSS or Javascript --&gt;
      name = "..."   &lt;!-- <strong>name</strong> is used by the server --&gt;
      action = "..." &lt;!-- <strong>action</strong> is the URL of a server script --&gt;
      method = "..." &lt;!-- <strong>method</strong> can be only GET or POST --&gt;
&gt;
   &lt;!-- Here go all elements of the form, such as &lt;input&gt;, &lt;button&gt;, etc. --&gt;
&lt;/form&gt;
</pre>
      
   <p>We have seen the attributes <code>id</code> and <code>name</code> before, thus, 
         let's focus on the two other attributes, <code>action</code> and <code>method</code>.</p>
         
         <ul>
            <li><strong>method</strong> specifies <em>how</em> the form content will be sent to the server</li>
            <li><strong>action</strong> specifies <em>where</em> the form content will be sent for processing</li>
         </ul>
   
      <p>There are two methods of sending the data to the server using the HTTP protocol: GET and POST. 
         The main difference between GET and POST is how the data is sent to the server. <br>
         GET will append the form field names and values onto the end of the URL as key/value pairs.<br>
         POST encodes the data differently and values are not visible in the URL.<br>
      
      </p>
      <p>
         The two forms below are identical, they have the same value for <strong>action</strong>
         (referring to the script <code>simple-script.php</code>), but one uses GET and the other POST.
         Try them out and look at the URL bar to see the difference.
         
      </p>
      <div class="row">
         <div class="col-md-5">
            <form name="getForm" action="simple-script.php" method=GET>
               <fieldset><legend>GET Form</legend>
               <p>Your Name: <input name="yourName"></p>
               <p>Your Class: <input name="yourClass"></p>
               <input type=submit>
               </fieldset>
            </form>
         </div>
         
         <div class="col-md-5">
            <form name="postForm" action="simple-script.php" method=POST>
               <fieldset><legend>POST Form</legend>
               <p>Your Name: <input name="yourName"></p>
               <p>Your Class: <input name="yourClass"></p>
               <input type=submit>
               </fieldset>
            </form>
         </div>
         </div>
         
      <br><br>   
      <p>GET: <img src="get.png" height=35></p>
      <p>POST: <img src="post.png" height=35></p>  
 
      <div class="alert alert-warning">
         Because submitting forms generates an HTTP request, you can use the Network tab in the Inspect Element
         window of the browser to inspect the details of sending forms, including how the data is packaged
         to be sent to the server.
      </div>
         
   <h2 id="php">Simple PHP to process your Forms</h2>

   <p>A widespread, server-side language called PHP can be used to process
     the form data sent from a browser and email it to someone. To avoid
     the PHP script being exploited by spammers, the PHP script will have
     the destination <q>hard-coded</q> into the script. That is, the form
     data can only be sent to a destination of your choosing, not the
     sender's.  This is perfect for emailing a "contact us" form to your
     organization's secretary, emailing the contents of an order form to
     your organization's fund-raising chair, and so forth.

     <p>We will not burden you with having to learn PHP just to use this
     ability.  Instead, we'll provide you with a mechanism for creating a
     PHP script that sends email to your desired recipient
     (the <q><em>to</em></q> address).  It will work a lot like the
     following, except that you won't be able to specify the recipient:
      
      <p>In fact, let us see a simple PHP script that will process the result from a simple 
        HTML form. <a href="phpform.html">Fill and submit this form first</a>, 
        and then check your email.</p>
      
   <p>In order for the script to access your name and address, it needs to know the exact
      <code>name</code> attribute values we used in writing the HTML form. Here is the code
         of our simple form:</p>
         
<pre>
  &lt;form method="post" action="emailscript.php"&gt;
      &lt;p&gt;Your Name:  &lt;input type="text" name=<strong>"from_name"</strong>&gt;
      &lt;p&gt;Your Email: &lt;input type="text" name=<strong>"from_email"</strong>&gt;   
      &lt;p&gt;Subject:    &lt;input type="text" name=<strong>"subject"</strong>&gt;
      &lt;p&gt;Body:       &lt;input type="text" name=<strong>"body"</strong>&gt;   
      &lt;p&gt;&lt;input type="submit" value="Submit form"&gt;   
   &lt;/form&gt;
</pre>
         
  <h2 id="ajax">AJAX Technology</h2>  
      
   <p>The problem with the first above-shown technique is that it redirects the user
         to a new web page. In fact, everytime a form is submitted the page is automatically
         either refreshed, or redirected to the result sent by the server.</p>
        
    <p>Sometime we might desire this, but sometime not. In fact, it is quite common to expect
        receiving notifications on the same page that we are already using. For that purpose,
        we will use a technology named AJAX.</p>
<p>
Ajax, which stands for "Asynchronous JavaScript and XML", is a way of passing data in a 
  structured format between a web server and a browser, often without the user being 
  aware of such a transaction, because there is no page refresh or redirection to a new page. 
  Thus, with Ajax and some DOM maipulation, you can load or reload only a portion of the page 
  with jQuery and JavaScript.</p>

<p>Although when the technology was introduced, the XML format (a relative of HTML) was used for exchanging data
between the server and the client, nowadays, JSON (Javascript Object Notation) is the preferred format. This 
is what we will use as well.</p>
        
  <p>The way AJAX works is summarized in the graphics below:</p>
<figure class="text-center">
        <img src="ajax.png" class="img-thumbnail">
  <figcaption>The AJAX technology for client-server communication. From "Head First jQuery" book.</figcaption>        
        </figure>

       <p>The AJAX technology is implemented within the jQuery library and can be used
        easily in our Javascript applications. In this course, we won't
        explore Ajax in all its glory, but we will use it to gracefully
        send email to a back-end script.
        
<h3 id="postajax">Example 1: Using AJAX to post data to the server</h3>
        
      <p>Let's first see it in action.  Here is the previous <q>RSVP</q>
        example, converted to Ajax: <a href="phpform-ajax.html">Fill and submit
        this form first</a>, and then check your email.</p>

      <p>Let's examine the JavaScript code:

<pre class="prettyprint lang-js linenums">
$("#ajax_send_button").click(sendmail);

function sendmail () {
  $.post(
    // first arg is action
    $("form").attr('action'),
    // second arg is data
    $("form").serialize(),
    // third arg is response callback
    function (response) {
        if( response.status == "ok" ) {
            var now = new Date();
            $("#response_element")
               .html("Your mail was sent at "+now.toLocaleTimeString())
               .css("color","green");
        } else {
            $("#response_element")
               .html("Sorry, your mail was not sent")
               .css("color","red");
        }
    },
    // fourth arg is expected response type
    "json");
}       
</pre>

<p>The first line just makes <code>sendmail</code> the event handler for
  the button, which is no longer a button of type <code>submit</code> but
  is now just a plain <code>button</code>.

<p>The <code>sendmail</code> function consists of just one call to the
  jQuery <code>.post()</code> method.

  <pre>
// The four parameters of the $.post() method

$.post(URL, data, function(data), dataType)
</pre>
        <p>Out of these four parameters, only the URL is always required, however, most of the time
        we will provide argument values for at least the three first parameters.</p>
        
        <ol>
          <li><em>URL</em> - this is the relative path to the server script that will take care of the 
          data that the HTML page will submit. For us, this will always
          be the same as the <code>ACTION</code> attribute of the form,
          so we might as well use that. </li>
          <li><em>data</em> - this variable will contain all the information collected by the form, or 
            other information of the page. Often the jQuery method <code>.serialize()</code> will be 
            used to package the data in a format that is easy to transport.</li>
          <li><em>function(data)</em> - this is the <strong>callback</strong> function that
          will be invoked by the browser, once it gets the response from the server. The response
          will be stored in the first parameter, <em>data</em>. We can
          then do whatever we want. Here, we put some text in the
          response element, which is an empty paragraph on the page.</li>
          <li><em>dataType</em>.  Our back-end script will respond in
          JSON, as we saw earlier, in the pre-ajax version.
        </ol>

      <p>Return to the <a href="phpform-ajax.html" target="_blank">Ajax
        example page</a> and also open the Console.  Notice all messages
        in the Console after you click on "Submit form". Then, open the
        view source page and study the jQuery code at the bottom. The
        comments should help you understand every line of code.
      </p>      
        
      <h2 id="dedicated_mail">Sending Mail to Predetermined Address</h2>

      <p>Here's an example of the kind
      of <a target="_blank" href="../../../php/mailto_scott_anderson_at_wellesley_edu.html">dedicated
      email script</a> we will use.


    </div> <!-- end of col-md-8-->
  </div> <!-- end of row-->
  <!--#include virtual="/~cs110/modularity/footer.part" -->
 </div> <!--end of container>
        
        
 <!--#include virtual="/~cs110/modularity/bs-footer.part" -->
</body>
</html>
