<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Activities</title>
    <!--#include virtual="../../modularity/bs-head.part" -->
    <link rel="stylesheet" type="text/css" href="http://cs.wellesley.edu/~cs307/js/google-code-prettify/prettify-sda.css">
  <script src="http://google-code-prettify.googlecode.com/svn/loader/prettify.js"></script>
    <style>
      #TOC_list {list-style-type: none;}
    </style>
    
  </head>
  <body>
    <!--#include virtual="../../modularity/navbar.part" -->

    <div class="container">
      <h1>jQuery UI, Ajax, and Email</h1>
      <hr>
    </div>
      
    <div class="container">
      <div class="row">
     
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">  
              <div id="insert_TOC_here"></div>
            </ul>
          </div>
        </div>

        <div class="col-md-8">
          
<!--  <div class="alert alert-warning"> </div> -->

<h2>Goal</h2>

<p>By the end of today, you will be able to:
  <ol>
    <li><p>Have an appreciation of the jQuery UI</li>
    <li><p>Have a working PHP script that sends email to <em>you</em>
    <li><p>Use jQuery to send form data to you using that script and Ajax</li>
  </ol>
  
<h2>Recap</h2>

<p>We learned about three major topics:  jQuery UI, Form Submission, and
  Form submission via Ajax.

<h3>jQuery UI</h3>

  <ul>
    <li>jQuery by itself is very powerful and people use it by itself all
  the time.
      
    <li>jQuery UI builds on it to provide lots of commonly wanted
    user-interface effects

    <li>See tons of demos and documentation
    at <a target="_blank" href="http://jqueryui.com">jqueryui.com</a>
      
    <li>We'll take a few minutes to check those out, particularly
      autocomplete, buttons, and tabs.

    <li>We'll also look at <a href="jqueryUI-ex.html">our own examples</a>

    <li>There are lots of good tutorials online. There are bad ones, too,
      so if you can't make head or tail of one, drop it and try another.

    <li>Don't limit yourself to jQuery UI. There are plug-ins and such out
      there to do slideshows and more.

  </ul>

  <p>

<h3>Forms</h3>

<ul>
  <li>Forms are the primary way that users <em>send</em> information to
  the server (back end), rather than receive it.
    
  <li>Even things that don't look like forms are probably just forms in
    disguise, such as Facebook updates.
    
  <li>Form require:
    <ul>
      <li>a set of <em>input</em> elements. We've see these before
      in <a href="../L09/forms1.html">the forms reading</a>
        
      <li>each input must have a <em>name</em>.  The browser sends
        name-value pairs to the server when the form is submitted.  The
        names are determined by the programmer, while the values come from
        the user. (mostly; there are hidden inputs and such)
        
      <li>the <code>form</code> tag has an <code>action</code> attribute
      that specifies the script (on the server) that will get and process
      the data submission
        
      <li>the <code>form</code> tag also has a <code>method</code>
      attribute that chooses either <code>GET</code>
      or <code>POST</code>.  (The default is <code>GET</code>.)
        <ul>
          <li>GET puts all the data in the URL, so it is limited in length
          and vulnerable to shoulder surfing and such, but nice for
          emailing, bookmarking and such.
            
          <li>POST sends the data later in the request, so it can be
          essentially unlimited in length and can be slightly more
          secure. 

          <li>neither is really secure without HTTPS
        </ul>

    </ul>
</ul>

<h3>Ajax</h3>

<ul>
  <li>In the olden days, forms were only submitted by the browser and the
    page with the form was replaced by the response from the back-end
    script.  This is still the most universal and accessible mode.
    
  <li>In modern times, forms can be submitted by JavaScript while the user
  continues to interact with the page.

  <li>JavaScript can also set up a <em>response handler</em>, which is
  yet another kind of event handler.  In this case, the response handler
  is a function that gets invoked when the response from the back-end
  script arrives.
    
  <li>The function gets invoked with the response as its argument, so it
  can look at the response and figure out what to do. 

</ul>

<p>This capability is called <em>Ajax</em>.  Ajax allows a web browser to
  act like a desktop application.  Think Gmail and Google apps.

<p>Ajax can either be used to receive info from the server (e.g. Facebook
  updates, new mail from Gmail) or to send info to the server
  (e.g. Facebook posts, sending mail).

<p>In this course, we'll only use it to send mail, but you should know its
  wider applicability.

  <h2>Quiz Question Nr. 1</h2>
  <p>Forms can use ...
  <ol type="A">
    <li><p>the GET method
    <li><p>the POST method
    <li><p>the SUBMIT method
    <li><p>the ACTION method
  </ol> 
          
  <h2>Quiz Question Nr. 2</h2>
  <p>To put the form data in the URL when submitting the form, the page
  author should use
  <ol type="A">
    <li><p>the GET method
    <li><p>the POST method
    <li><p>either A or B
    <li><p>none of the above
  </ol> 

  <h2>Quiz Question Nr. 3</h2>

  <p>Ajax ...
  <ol type="A">
    <li><p>is something that happens in the browser
    <li><p>is something that happens on the server
    <li><p>is a way to pass data from the browser to the server
    <li><p>is a way to pass data from the server to the brower
  </ol> 

<h2>Ajax Recap</h2>

<p>Ajax is tricky because we can't use the following reasonable idea:
<pre class="prettyprint lang-js">
// the following does *not* work:
var data = $.get("url");
processResult(data);
</pre>

<p>The reason is because of the fact that, from a computer's point of
  view, it takes <em>forever</em> (millions of cycles) for the data to
  arrive from the server. So, it doesn't want to wait that long
  for <code>.get</code> to return and assign a value to <code>data</code>.
  The browser doesn't want to freeze for all that time, waiting for the
  data to arrive.

<p>Instead, it requires you to supply a function, an <em>event
    handler</em>, which will then get invoked when the data does
    arrive. This event handler is also called a <em>callback</em>. The
    callback is invoked with the data as its argument, since that's
    presumably why you requested it.  In our example
    above, <code>processResult</code> is perfect as a callback
    function. Therefore, we do:

<pre class="prettyprint lang-js linenums">
$.get("url", processResult);
</pre>
  
<p>Of course, in practice, the event handler is often an anonymous
  function, so the code looks like:
  
<pre class="prettyprint lang-js linenums">
$.get("url", function (data) {
    console.log("data arrived at last");
    processResult(data);
});
</pre>

<h2>Task #1, analysis</h2>

<p>With a partner, using the following <a target="_blank" href="Forms/ajax-v1.html">AJAX
  example</a> and your JavaScript console, determine the following:
<ul>
  <li>How long does it take for the data to arrive?
    
  <li>Does it take the same amount of time every time?
    
  <li>How many students are in the first section?  The second?
    
  <li>How would we have to modify the code to put all the students on the
  list, instead of just the first three?

  <li>What URL is the data gotten from?
    
  <li>If you visit that URL (just copy/paste it into your browser location
  bar), you can see the actual data that is sent.

</ul>

<h2>Ajax and Email Forms</h2>

<p>We can also use Ajax to <em>send</em> data to the server.  We will send
  data from a form, and we will use the POST method.  Let's first figure
  out, though, the data we're going to send and how we will send it.

<p>Let's start with specific examples.  

<ul>
  <li><a target="_blank" href="Forms/phpform.html">email form w/o Ajax</a>.

  <li><a target="_blank" href="Forms/phpform-ajax.html">email form w/ Ajax</a>.
    
</ul>

<h2>Restricted Web Email</h2>

<p>Both of the above forms allowed you to specify the <em>recipient</em>
  (so you could send it to yourself) but not the <em>content</em>.
  Couldn't we provide a more flexible form that would allow you to specify
  all the email essentials:
  <ul>
    <li>from
      
    <li>to
      
    <li>cc

    <li>subject
      
    <li>body
  </ul>

<p>Yes, we could, but it would be a <em>very bad</em> idea. Spammers would
  find that form in about ten minutes are start using it to send
  spam. Even if you look at our scripts and figure out how to do
  this, <em>don't.</em>  You'll get your server blacklisted and then you
  won't be able to send legitimate email.

<p>In our examples, we will restrict the email in various ways to make it
  unappealing to spammers.  The primary way is to restrict
  the <em>recipient</em>. The bad guys could fill up the recipient's email
  box, but they can already do that.

<h2>Submitting the form using Ajax</h2>

<p>The back-end script determines what form inputs are meaningful. Our
  email scripts look for the following:

  <ul>
    <li>from_name
      
    <li>from_email
      
    <li>subject
      
    <li>body
  </ul>

<p>If additional inputs are sent, they are silently ignored.  

<p>In the two examples above, we only let you specify the first two
  inputs: the subject and body of the email were pre-specified.

<h2>Serialize a Form</h2>

<p>An HTML <code>&lt;form&gt;</code> is a container for a bunch of inputs.
  We know there's a DOM tree that represents the whole form. When the form
  data is sent to a server for processing, that name-value pairs in the
  form have to be converted into a <em>string</em>.  This is
  called <em>serializing</em>.

<p>We first saw <em>serializing</em> when we looked at the URL for a form
  that uses the GET method.  The string in the URL is
  the <em>serialized</em> representation of the form data.

<p>jQuery has a method for serializing a
form: <a href="http://api.jquery.com/serialize">serialize()</a>

<h2>Task #2: Form Serializing</h2>

<p>With a partner, using the
  following <a target="_blank" href="Forms/example-form.html">example form</a> and your
  JavaScript console, determine the following:

<ul>
  <li>What does the result of serializing a fully completed form look like?

  <li>What does the result of serializing an empty form look like?
    
  <li>Go ahead and submit some of those forms. What do the responses look
  like?
</ul>

<h2>Submitting a Form by Ajax</h2>

<p>Just like the
 jQuery <a href="http://api.jquery.com/get"><code>.get()</code></a> method
 that we used earlier, jQuery has
 a <a href="http://api.jquery.com/post"><code>.post()</code></a> method
 that we can use.

<p>We'll combine the <code>.post()</code> method with
  the <code>.serialize()</code> method to send our form data to the server
  and then process the response.

<h2>Formatting an Email</h2>

<p>Suppose we give the user some choices about the body of the email but
  not the recipient. If we further allow ourselves to format the result
  more nicely than those bullet lists earlier, we can get something like
  the following example:

<p><a href="Forms/pizza-form.html">pizza order form</a>

<p>We'll spend some time on that, understanding the code.

<h2>Generating a PHP Script</h2>

<p>If you want to use this facility, we need a way for you to create the
  appropriate PHP script.  Rather than teach you the language just for
  this one purpose, we've created a <q>meta-script</q>: a script that
  writes a PHP script for you.  It has a form for you to fill out with
  your email address and your desired default values, and then gives you a
  PHP script in your <code>Downloads</code> folder (or wherever your
  browser puts it).

<h2>Task #3: Email Forms</h2>

<p>This task will ensure that the basics of email form submission work for
you.
  <ol>
    <li>Fill out the <a href="../../php/make-eform.php">creation</a>
    form.  When you submit it, it'll send back a personalized PHP script
    that your browser will download.
      
    <li>Using Fetch (or some other FTP client), create a "mail-form"
    folder on the server, in your <code>public_html</code>.
      
    <li>Copy the downloaded PHP script to that folder.
      
    <li>Download a copy of this <a href="Forms/tiny-form.html">tiny-form.html</a>.
      
    <li>Edit it to specify your PHP script in the action attribute,
    replacing the bogus value in the original.
      
    <li>Copy it to the server into that same folder, so that the relative
    URL for the PHP script is correct.  You will now have a folder with an
    HTML file and a PHP file: the HTML file has a form that uses the PHP
    file to send mail to <em>you</em>.
      
    <li>Test it by filling out the form and sending yourself an email
    message.

  </ol>

<h2 id="sec_summary">Summary</h2>
<p>We hope that after these activities you have a good understanding of 
  <ul>

    <li>Ajax can be used to get info, such as a list of students, or the
    latest Facebook updates, from a server.  

    <li>The
    jQuery <a href="http://api.jquery.com/get"><code>.get()</code></a>
      and <a href="http://api.jquery.com/post"><code>.post()</code></a>
    methods need:
      <ul>
        <li>a URL
          
        <li>some data to send, though this is optional (sometimes the URL
        is all we need)
          
        <li>a <em>callback</em> function to handle the response.
      </ul>
      
    <li>Those methods can be used to send a form to a server.
      
  </ul>

<h2 id="sec_solutions">Solutions</h2>

<p id="solutions_later">Will be posted later, visit again after
  <span id="later"></span></p>

<div id="solutions" style="display: none">
<p>Task #1. I found that each <code>.get</code> took from 150 to 500
  ms. Quick, but hardly instantaneous.

</div>
<script>
var now = new Date();
var later = new Date("04/21/2015 5:00 PM");
document.querySelector("#later").innerHTML = later.toLocaleString();
if( now > later ) {
    document.querySelector("#solutions").style.display = "block"; // $("#solutions").show();
    document.querySelector("#solutions_later").style.display = "hidden"; // $("#solutions").show();
}
</script>

      </div><!-- end of row -->
    </div><!-- end of class=container -->



    <!--#include virtual="../../modularity/bs-footer.part" -->
    <script src="../../js/TOC.js"></script>
    <script src="/~cs307/js/google-code-prettify/prettify.js"></script>
    <script>insertTOC_textual(); prettyPrint();</script>
    <script>
      function hideItem() {
          // hide a PRE or a P inside the LI (this). Don't hide the
          // whole LI, or the numbering changes.
          $(this)
              .find("pre,p")
              .css('border-color','red')
              .css('background-color','#FF8080')
              .fadeOut(1000);
      }

      $("li").click(hideItem);
    </script>
   </div>
  </div>
  <!--#include virtual="/~cs110/modularity/footer.part" -->
 </div> <!--end of container>
        
        
 <!--#include virtual="/~cs110/modularity/bs-footer.part" -->
  </body>
</html>
