<!DOCTYPE html>
<!-- 
File: storage.html
Author: Eni Mustafaraj
Date: 04/06/14
Purpose: Explain the HTML5 Web Storage API.
-->

<html lang="en">
  <head>
    <meta charset="utf-8">        
    <title>CS110: HTML5 Web Storage</title>
        
    <!--#include virtual="/~cs110/modularity/bs-head.part" -->
 </head>
    
  <body>
    <!--#include virtual="/~cs110/modularity/navbar.part" -->
    
    <div class="container">
      <h1>HTML5 Web Storage API&nbsp;<small>Storing information locally</small></h1>
                        <hr>                    
    </div>
    
    <div class="container">
      <div class="row">
            
         <!-- Three columns of the grid are reserved for the sidebar-->
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">
             <li><a href="#example">Storage Example</a></li>
             <li><a href="#api">Web Storage API</a></li>
             <li><a href="#code">Code Snippets</a></li>
            </ul>  
          </div><!-- end of "bs-sidebar"-->
        </div><!--end of "col-md-3" div-->
                                        
                                        
            <div class="col-md-8">      
        <h2 id="example">Storage Example</h2>
        
        <div class="bs-callout bs-callout-warning"> 
          <h4>In-depth Reading</h4>
          <p>If after reading these notes and seeing the example shown below,
          you want to make use of the <code>localStorage</code> object in your project, 
          we strongly recommend
          that you read <a href="/~cs110/LocalOnly/chap9_html5.pdf">Chapter 9</a> from the 
          <a href="http://www.headfirstlabs.com/books/hfhtml5prog/">Head First 
          HTML5 Programming book</a>. 
          All examples
          of that chapter can be found in <a href="chapter9/">this folder</a>.</p>
        </div>
        
        <p>We are starting these notes with an example of an application that lets a user
        create sticky notes on a web page. The whole process is described step by step
        in the <a href="/~cs110/LocalOnly/chap9_html5.pdf">supplemental reading</a>.
        You can <a href="chapter9/notetoself4.html">open the application</a> on a new page 
          and try it out on your own (type 
          some text on the input box and then click the button). Below is how the page
          looks like after I have added four notes.
        </p>
        
        <figure>
            <img src="images/stickies.png" alt="the stickies storage example" 
                 class="img-thumbnail" width=800>
            <figcaption>Screnshot from the Stickies app that uses local storage.</figcaption>
        </figure>
        
        <p>This example is interesting also because it uses some sophisticated CSS3 features
        (such as transition) to create animation effects for the sticky notes.</p>            

        <h2 id="api">Web Storage API</h2> 
        <p>HTML5 introduced several Javascript APIs (Application Programming Interfaces) that 
        are now directly accessible from the browser, without having to write custom code
        or import external libraries. Some examples are the 
          <a href="http://www.w3schools.com/html/html5_geolocation.asp">Geolocation API</a>
          (that can locate the geographical location of a user and perform other related 
          operations),
          the <a href="http://www.w3schools.com/tags/ref_canvas.asp">Canvas API</a> (that 
          allows drawing 2D graphics and animation on the webpage), or the
          <a href="http://www.w3schools.com/html/html5_webstorage.asp">Web
          Storage API</a> that allows web applications to store data
          locally on the device of the user. That is, the data is stored
          on your laptop, not in the cloud or on a server somewhere, so
          it's not available to other people.  Still, local storage can be useful.
        </p>
        
        <p>The Web Storage API creates an internal object named <code>localStorage</code>
        that we can access directly in our Javascript programs in the same way
        that we access <code>window</code> or <code>document</code>. Through
        this object we gain access to its methods that allow us to store data
        locally, retrieve them, iterate through them, or remove them when we desire.
        
        <p>We have summarized these properties and methods in the table below:
        
         <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>Method/<br>Property</th>
                <th>Usage Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>.length</code></td>
                <td><code>localStorage.length</code><br>
                 The number of items stored in the storage.
                </td>
              </tr>
              <tr>
                <td><code>.setItem()</code></td>
                <td><code>localStorage.setItem("zip", "02481")</code><br>
                Stores an item as a pair of a key and value.
                </td>
              </tr>
              <tr>
                <td><code>.getItem()</code></td>
                <td><code>localStorage.getItem("zip")</code><br>
                Retrieves the value stored under the key that is passed as 
                an argument to the method.
                </td>
              </tr>
              <tr>
                <td><code>.clear()</code></td>
                <td><code>localStorage.clear()</code><br>
                Removes all items stored in the local storage.
                </td>
              </tr>
              <tr>
                <td><code>.removeItem()</code></td>
                <td><code>localStorage.removeItem("zip")</code><br>
                Removes only one item, whose key is passed as the argument.
                </td>
              </tr> 
              <tr>
                <td><code>.key()</code></td>
                <td><code>localStorage.key(1)</code><br>
                Retrieves the name of the key with index 1 (imagine that keys are
                stored in a array and we can access each of them through the index).
                </td>
              </tr>              
            </tbody>
          </table>
          
          <h2 id="code">Code Snippets</h2>
          <p>We can inspect the content of the <code>localStorage</code> at any
          time, by using the Inspect Element window. If you haven't yet run any
          of our examples that use <code>localStorage</code>, its content
          is going to be empty, and you can view it like shown in the image below (that is,
            choose the tab Resources, and under Local Storage click on the URL for 
            our website): 
        
        <figure>
            <img src="images/emptyStorage.png" alt="screenshot of empty storage" 
                 class="img-thumbnail" width=700>
            <figcaption>Inspecting <code>localStorage</code> in the Inspect Element
            window.</figcaption>
        </figure>        

      <p>In the following we are providing a series of statements that show how 
        to use the different properties and methods of <code>localStorage</code>,
        so that you get some practice with them.</p>
      <div>
       <textarea rows=17 cols=85>
 // Let's clear storage to make sure we start with clean state
 localStorage.clear();
 
 // Let's add some items
 localStorage.setItem("city", "Wellesley");
 localStorage.setItem("zip", "02481");
 localStorage.setItem("state", "MA");
 
 // check how many items are stored
 alert("There are " + localStorage.length + " items.");
 
 // retrieve an item
 alert("Show value for 'city': " + localStorage.getItem("city"));
 
 // show the name of a key using its index
 alert("Key name for index=2 is: " + localStorage.key(2));
       </textarea><br>
    <button onclick="eval(this.parentNode.firstElementChild.value);">Execute it</button>       
</div> 
<br>
 <p>The last alert result, "Key name for index=2 is: zip" should surprise you,
    since we are used to array indexing where the first element has index 0, 
   the next one has index 1, and so on. According to that pattern, you might have
   expected that index=2 referred to the key "state". However, inside the localStorage, the
   keys are stored alphabetically (not in the order in which they were introduced), thus,
  "zip" happens to have index 2 out the three items stored so far (because the other keys start
   with letters "smaller" than z). To test this,
   enter the following two lines at the end of the textarea and execute the code again.</p>
   <pre>
localStorage.setItem("address", "105 Central St.");
alert("Key name for index = 0 is: " + localStorage.key(0));
</pre>
   
    <p>Notice how the index of "address" is 0, even if it was the last item added to the
        storage.</p> 
        
    <p>Here is some more code to execute:</p>
        
     <div>
     <textarea rows=9 cols=85>
// store a number value
localStorage.setItem("parkedCars", 10);
    
// increase the number
localStorage.setItem("parkedCars", localStorage.getItem("parkedCars") + 1);

// show the new value
alert("There are " + localStorage.getItem("parkedCars") + " parked cars.");
     </textarea><br>
    <button onclick="eval(this.parentNode.firstElementChild.value);">Execute it</button>       
</div>
       <br> 
        <p>Can you explain why we got a wrong result? Find a way to fix the problem.</p>
        
      <div class="bs-callout bs-callout-warning"> 
          <h4>Web Storage versus Cookies</h4>
      <p>Until the introduction of HTML5, storing data in a client was
        done through a technology named "cookies". Cookies are information
        that is stored both in the client browser and on the server of the
        website that is setting these cookies.  While cookies are still
        being used, for interactions with a server (they are crucial for
        Facebook and Gmail, for example), the tendency is to go away from
        them for just local storage.  If you are curious about how cookies
        work, we invite you to read this
        <a href="http://cs.wellesley.edu/~cs110s13/lectures/M13-cookies/index.shtml">
          Lecture on Cookies</a> from CS110 Spring 2013.
        This semester, we will not cover cookies.</p>  
      </div>
  
</div><!--end of "col-md-8"-->
            
</div><!--end of "row"-->

<!--#include virtual="/~cs110/modularity/footer.part" -->
    
</div> <!--end of container>
        
        
<!--#include virtual="/~cs110/modularity/bs-footer.part" -->
</body>

</html>
