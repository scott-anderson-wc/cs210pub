<!DOCTYPE html>
<!--
File: halloween.html
Author: Eni Mustfaraj
Date: Oct 29, 2014
Purpose: To show functions, global variables, arrays, loops, event handlers, etc.

Images of the spooky icons come from:
http://deleket.deviantart.com/art/Halloween-Avatars-66955374
-->
<html lang="">
<head>
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="">
  <style>
    h1 {color: #cf8833;}
    h3 {color: darkred;}
    body {background-color: black; text-align: center}
    main {margin: 20px;}
    div {
      float: left; 
      width: 100px;
      height: 100px;
      border: 1px red solid;
      margin: 2px;
    }
    div img {width: 100px; visibility: hidden;}
    div.shown img { visibility: visible; }
    div:hover {cursor: pointer; border-color: #cf8833;}
  </style>
</head>

<body>
  
  <main>
  <h1>Click everywhere on the page to discover hidden monsters</h1>
  <h3>Found <span id="found"></span> out of <span id="total"></span></h3>
    <!-- Here is where all the div-s will be added by Javascript code -->
  </main>
  
  <script>
// Global Variables
var foundByUser = 0; // to store number of mosters found by user
    
var fileNames = ['Alien', 'Alien2', 'Alien3', 'Alien4', 'Bat', 'Clown', 'Clown2', 'Devil', 
                 'Devil2', 'Devil3', 'Doll', 'Doll2', 'FacePaint', 'Ghost', 'Ghost2', 'Ghoul', 
                 'GrimReaper', 'JackOLantern', 'Man', 'Mask', 'Mask2', 'Mask4', 'Mask5', 'Monster', 
                 'Mummy', 'Pumpkin', 'RedSkull', 'SeaMonster', 'Skull', 'Skull2', 'Slasher', 
                 'Slasher2', 'Vampire', 'Vampire2', 'VoodooDoll', 'Werewolf', 'Witch', 'Zombie', 
                 'Zombie2', 'Zombie3', 'ZombieFemale'];

/* The function that is called to start the game. Invokes most other functions.*/    
function prepare_game() {
  
    var cellsCount = create_grid();
    
    // randomly select the number of total images
    var filesCount = fileNames.length;
    var imageLimit = Math.min(filesCount,cellsCount);
    var totalImages = Math.floor(Math.random()*imageLimit);
  
    // Set the initial values of span elements.
    document.querySelector("#total").innerHTML = totalImages;
    document.querySelector("#found").innerHTML = foundByUser;
  
    // randomly select the image indices
    var imageIdxArr = getArrayRandomNumbers(totalImages, filesCount);
    // randomly select the div indices to hold the images
    var divIdxArr = getArrayRandomNumbers(totalImages, cellsCount);
    
    setImages(imageIdxArr, divIdxArr);
}

/* The function that randomly sets all images in divs.*/    
function setImages(imgArr, divArr) {
  
    console.log("inside setImages");
    if( imgArr.length != divArr.length ) {
        console.log("something has gone wrong: array lengths don't match");
        return; // stops execution of the function
    }
    for (var i=0;i<imgArr.length;i++){
        var imgIdx = imgArr[i];
        var divId = divArr[i];
        setOneImage(imgIdx, divId);
    }
}

/* Given the index of an image file and that of a div element, creates
   an image element, sets its attributes and displays it on the div.*/
function setOneImage(imageIndex, divId) {
    console.log("image "+imageIndex+" will go in cell "+divId);
    var div = document.querySelector("#i_"+divId);
    var imgEl = document.createElement("img");
    var filename = fileNames[imageIndex];
    imgEl.setAttribute("src", "spooky/"+filename+".png");
    imgEl.setAttribute("alt", filename);
    div.appendChild(imgEl);
    div.onclick = showImage; //bind the event handler for the click event
}

/* Event handler function invoked when a div is clicked. Only divs that have
   hidden images will handle the click event, "show" the image and increment the 
   game counter. */
function showImage() {
    // find div that was clicked to show in console
    var divId = this.getAttribute("id");
    console.log("Found "+divId);
    // alert("Found you!");
    this.classList.add("shown"); // makes the image visible
    foundByUser += 1;
    document.querySelector("#found").innerHTML = foundByUser;
}
    
/* This function looks up the dimensions of a page and creates a grid of
   floating divs, giving to each of them one ID.  It returns the total
  number of cells, so that we can use it somewhere else. */

function create_grid() {
    
    var width = document.body.scrollWidth;
    var height = document.body.scrollHeight;
    var cols = Math.floor(width/100);
    var rows = Math.floor(height/100);
    
    var totalCells = cols*rows; //create a grid      
    for (var i=0; i<totalCells;i++){
        var div = document.createElement("div");
        div.setAttribute("id", "i_"+i.toString());
        document.querySelector("main").appendChild(div);
    }
    return totalCells;
}

prepare_game();

// ================================================================
// Read below here at your own risk!  :-)

// Returns an array of total non-repeating random numbers in the range
// [0..maxVal). Obviously, if total > maxVal, this is impossible, and as
// total approaches maxVal, the algorithm becomes slower, though not
// noticeably so.

function getArrayRandomNumbers(total, maxVal) {
    if(total >= maxVal) {
        throw "can't get "+total+" different numbers less than "+maxVal;
    }
    console.log("getting "+total+" numbers less than "+maxVal);
    var numbersArr = [];
    while (numbersArr.length < total){
        var randomVal = Math.floor(Math.random()*maxVal);
        //console.log(randomVal);
        if (numbersArr.indexOf(randomVal) == -1)
            numbersArr.push(randomVal)
    }
    return numbersArr;  
}
    
// An alternative algorithm
function sampleWithoutReplacement(numSamples, maxVal) {
    if( numSamples > maxVal ) {
        throw "can't get "+numSamples+" different numbers less than "+maxVal;
    }
    if( false && numSamples < maxVal/2 ) {
        var chosen = [];
        while(chosen.length < numSamples) {
            var randomVal = Math.floor(Math.random()*maxVal);
            if(chosen.indexOf(randomVal) == -1) {
                chosen.push(randomVal);
            }
        }
        return chosen;
    } else {
        // a very different algorithm
        var i, all = [];
        for(i=0; i<maxVal; i++) {
            all.push([i,Math.random()]);
        }
        // sort by the random value
        all.sort(function (a,b) { return a[1]-b[1]; });
        var chosen = [];
        for(i=0; i<numSamples; i++) {
            chosen.push(all[i][0]);
        }
        return chosen;
    }
}
    
</script>
</body>
</html>
