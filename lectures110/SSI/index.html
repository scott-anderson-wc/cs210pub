<!DOCTYPE html>
<html lang="en">
<!-- 
    Fall 2007: Lightly edited by Mark.  Some text tightening, remove
    unnecessary quotation marks from English text, insert appropriate
    quotation marks in sample HTML code :-)

January 2010, Scott: rewrote this to use .shtml and .part, and made it a
separate page

Minor changes by Ellen for Fall '10

September 2011, Tyler created a link to the source code as it appears on the server

Feb 2014, Eni moved the content to the new layout. She also replaced SHTML with HTML.
-->
<head>
    <title>CS110: SSI</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Scott D. Anderson and the CS110 Staff">
    <meta name="description" content="Modularithy using CSS">
    <meta name="keywords" content="">
    <!--script type="text/JavaScript" src="../../js/addOnLoad.js"></script>
    <script type="text/JavaScript" src="../../js/TOC.js"></script>
    <script type="text/JavaScript" src="../../js/verbatim.js"></script-->
    <!--#include virtual="/~cs110/modularity/bs-head.part" -->
  </head>
    
  <body>
    <!--#include virtual="/~cs110/modularity/navbar.part" -->
    
    <div class="container">
      <h1>Modularity via Server-Side Includes<small></small></h1>
      <hr>

      <div class="container">
      <div class="row">
            
        <!-- Three columns of the grid are reserved for the sidebar-->
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">
              <li><a href="#why">Why use Server-Side Includes?</a></li>
              <li><a href="#bugs">Bugs</a></li>
              <li><a href="#recaps">SSI Recap</a></li>
            </ul>  
          </div><!-- end of "bs-sidebar"-->
        </div><!--end of "col-md-3" div-->
        
        <div class="col-md-8">
          
        <h2 id="why">Why use Server-Side Includes?</h2>

<p>Very often in a website, there is repeated material on each page.  For
example, each of the lecture pages in this course has a <q>navbar</q> at the top
that
includes the links to the major components of the website.

<p>You certainly could copy/paste the repeated items to each page, but that makes
maintenance very difficult: if you decide to change the common content,
you have to edit every page, and you have to make sure you don't miss any
and that you edit them all in the same way.  For example, adding a new section
to your website that is accessible from the navbar would require changing every
single page!  For a small website, this is
bad, but for a large website, it is completely unreasonable.

<p>A solution is to break your page into pieces, each stored in a different
file, and have the server cobble them together whenever it responds to a
request for your web page.  This technology is called
<a href="http://en.wikipedia.org/wiki/Server_Side_Includes">Server Side
Includes</a> or SSI.  Exactly how to use it depends on the server
software.  On the CS web server, we use Apache to serve web pages.  For more detail,
you can read
the <a href="http://httpd.apache.org/docs/2.2/howto/ssi.html">Apache
tutorial on Server Side Includes</a>.

<p>Suppose we have three pages, A, B, and C, all of which should share a
  common header and footer, each of which is in a separate file.  These
  shared pieces will be <em>included</em> into the main pages.  Thus, we
  have five files, none of which is a complete page:
  
  <ul>
    <li><a href="ssi/A.html">ssi/A.html</a>
    <li><a href="ssi/B.html">ssi/B.html</a>
    <li><a href="ssi/C.html">ssi/C.html</a>
    <li><a href="ssi/header.part">ssi/header.part</a>
    <li><a href="ssi/footer.part">ssi/footer.part</a>
  </ul>

<p>In the list above, there are two kinds of files:
  <ul>

    <li><q><code>.html</code></q> This kind of file <em>includes</em>
    another file as part of itself. The <code>.html</code> files are the container
    files, so they have all the usual infrastructure: They start with
    a <code>doctype</code> element and have tags
    like <code>html</code>, <code>head</code>, and so forth.

    <li><q><code>.part</code></q> This kind of file is <em>included</em>
    in another file.  It's just a fragment of a web page, such as just the
    navbar or just the footer.  It <em>doesn't</em> have
    a <code>doctype</code> element, thus, it is not a valid HTML document.

  </ul>

<p>In the source code of the HTML files A, B, and C, we put a special
  marker, called a <em>directive</em>, that the server will look for and
  replace with the contents of the included files.  The directive looks
  like an HTML comment, so that if the SSI doesn't happen for some reason,
  the directive won't otherwise mess up your code.  Let's look at what
  page A's source code looks like:

<pre>
&lt;!--#include virtual="header.part" --&gt;

&lt;p&gt;Here is some content that is unique to &lt;strong&gt;page A&lt;/strong&gt; of the website.

&lt;!--#include virtual="footer.part" --&gt;
</pre>

<p>The text in quotes after the word <q>virtual</q> is a relative URL for the
file to be included at that point in the main file.

<p>Note that if you <q>View Source</q> on <code>ssi/A.html</code>, you
won't see these directives.  Instead, you'll see the included content.
The server obeys the directives and constructs the page from the parts and
sends it out, and the browser has no way of knowing what the original file
was, or even that SSI was involved at all.  SSI is completely invisible.

<!--p>The server has to do additional work to scan for these SSI directives,
  and so to avoid having the server scan files that don't need to be
  scanned, the file has to be marked somehow.  On Puma, as on many web
  servers, we do this by naming the file <em>.shtml</em>.  The server
  automatically scans all <code>.shtml</code> files looking for SSI
  directives.  (An alternative that is sometimes done is by making the
  file <q>executable</q>, which is just a special bit associated with the
  file.)</p-->
  
<div class="bs-callout bs-callout-warning">
  <h4>Important Note</h4>
  In order for the server to know that it has to do some extra work in
  cases when the files contain <em>directives</em>, we <strong>must</strong>
  make the file <strong>executable</strong>. Files on the server can be
  read, written, executed, and any combination of these three operations.
  These are known as <q>file permissions</q> and can be set through the 
  Fetch / WinSCP / FileZilla interface.
  
  <p>We will always have to set the execution bit on, in order for SSI
  directives to work. Figure 1 shows how the folder for our example looks
  like. All HTML files have an extra <strong>x</strong> value in their
  list of permissions. We will show in lab how you can do that for your files.</p>

<p>Note that it's the <em>web server</em> that does
the work, so SSI will <strong>not</strong> work when viewing files on your
local desktop.  </p>

<p>Here is a <a href="ssi/A_onserver.html">copy of A.html</a> as it appears 
  on the server.  If you view the source, you can see what the code looks 
  like before the directives are included.</p>
  
  </div>
          
  <figure class="text-center">
    <img src="filepermissions.png" alt="screenshot of how the file permissions look like"
         class="img-thumbnail">
    <figcaption>Figure 1: A screenshot of how the file permissions look like on the server.</figcaption>
  </figure>

<h2 id="bugs">Bugs</h2>

<p>One common error is to put a space after the comment syntax:
  
<pre>
  &lt;!-- #include ... --&gt;
</pre>

<p>Unfortunately, this is treated as an ordinary comment, not an SSI
  directive, so be sure you do it exactly like this:

<pre>
  &lt;!--#include virtual="relative/path/to/file.part" --&gt;
</pre>

  
<p>Second, if you make a mistake in your SSI syntax or in the relative
  URL, you'll see something like the following in your main file, when you
  view it on the web:

<pre>
  [an error occurred while processing this directive]
</pre>

<p>For an example of this, see the file 
   <a href="ssi/C-broken.html">C-broken.html</a>, in which we
   intentionally put in a typo, changing the line

<pre>
  &lt;!--#include virtual="header.part" --&gt
</pre>

<p>to 

<pre>
  &lt;!--#include virtual="jeader.part" --&gt;
</pre>

so that you can see such an error in action.

<p>Finally, if you make a change to your <code>.part</code> file, you may
  not see any change when viewing the <code>.html</code> file in your
  browser.  This is very confusing and frustrating: didn't you change that
  web page?!

  <p>This happens because the server told the browser that
  the <code>.html</code> file hadn't changed (which is true), and so the
  browser saved time by just showing you the copy in the cache, instead of
  re-downloading the <code>.html</code> file.  On many browsers, 
  you can tell the browser to ignore the cache and
  really reload the file by holding down the <q>shift</q> key while
  reloading the file (in a Mac: Shift + Command + R).

<p>You also need to make sure that your <code>.part</code> file is 
accessible (readable by all) from the web. 

<!--h2 id="more">More than you wanted to know</h2>
<div class="aside">

<h3>Power</h3>

  <p>SSI can do a lot more than just include one file in another.  The
  server can put in information such as the modification date and time of
  the file.  It can put in today's date.  It can include the output of
  some dynamically executed program, such as a hit counter.  For more, see
  the Apache tutorial, above.

<h3>Recursion</h3>

  <p>Furthermore, in this description, we have limited SSI to just one
  level, but it's possible that the included file, which we have called
  the <code>.part</code> file, can itself be scanned for SSI directives.
  To do that, just re-name the <code>.part</code> file to be
  a <code>.shtml</code> file.  This can be continued to many levels, until
  the server puts a halt to it.  (You can even imagine a circular
  arrangement of includes, so that the including never ends; you probably
  shouldn't <a href="ssi/recur1.shtml">do that</a>.)  The general idea is
  called <em>recursion</em>.

  <p>Note that our terminology of <code>.part</code> files is not
  standard.  We thought it would be useful to distinguish the two kinds of
  files, <q>includer</q> and <q>includee</q>, but you now know that there
  is no distinction, because an <q>included</q> can also be
  an <q>includer</q>.

<h3>Support</h3>

  <p>Since SSI is done by the server, using it depends on the server
  software.  SSI is supported by Apache and lighthttpd, but not by IIS,
  which is Microsoft's web server software.  Apache is currently the most
  widely used web server software, but your client's web hosting site may
  not use it.

  <p>Should this occur, you could try to replace the SSI code with
  JavaScript, but that may not be accessible for all users (for example,
  screen readers may disable JavaScript code).  An alternative is to
  simply copy/paste the <code>.part</code> code in
  the <code>.shtml</code>, but that loses all of the advantages of using
  SSI.  A last alternative is to use a more powerful and portable
  server-side scripting language, such as PHP, but that's outside the
  scope of this course.


</div-->


<h2 id="recap">SSI Recap</h2>

<p>To do SSI, you must:
<ul>
  <li>Put the duplicate code in the <q>.part</q> file (the one
  you'll be including in other files)
  <li>Put the <em>directive</em> in the <q>.html</q> files
  <li>Upload both files to the server
  <li>Make your HTML files executable</li>
  <li>View the <q>.html</q> file.  You may need to
  use <q>shift+reload</q> in your browser to ignore the cache when
  refreshing the page

</ul>

<!--p>Note that you will validate the <q>including</q> files, but not
the <q>included</q> files, since the latter will, of course, be
incomplete.

<div id="ex1" class="ex"><span class="ex">Exercise 1</span>

<p>Using the files below, use SSI to have a common header and footer.
  Check that it works.  Then change either the header or footer and check
  that all pages change.
  <ul>
    <li><a href="ssi/A.shtml">ssi/A.shtml</a>
    <li><a href="ssi/B.shtml">ssi/B.shtml</a>
    <li><a href="ssi/C.shtml">ssi/C.shtml</a>
    <li><a href="ssi/header.part">ssi/header.part</a>
    <li><a href="ssi/footer.part">ssi/footer.part</a>
  </ul>

  <p>Note that you must upload to Puma for the exercise to work.  There's
  no web server to run the SSI code if you view the files locally. (But
  try that, so you'll know what it looks like.)
</div-->

        </div><!--end of "col-md-8"-->
            
      </div><!--end of "row"-->

    <!--#include virtual="/~cs110/modularity/footer.part" -->
    
    </div> <!--end of container>
        
        
    <!--#include virtual="/~cs110/modularity/bs-footer.part" -->
  </body>

</html>
