<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Activities</title>
    <!--#include virtual="../../modularity/bs-head.part" -->
    <link rel="stylesheet" type="text/css" href="http://cs.wellesley.edu/~cs307/js/google-code-prettify/prettify-sda.css">
  <script src="http://google-code-prettify.googlecode.com/svn/loader/prettify.js"></script>
    <style>
      #TOC_list {list-style-type: none;}
    </style>
    
  </head>
  <body>
    <!--#include virtual="../../modularity/navbar.part" -->

    <div class="container">
      <h1>Local Storage and Event Binding</h1>
      <hr>
    </div>
      
    <div class="container">
      <div class="row">
     
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">  
              <div id="insert_TOC_here"></div>
            </ul>
          </div>
        </div>

        <div class="col-md-8">
          
<h2>Goal</h2>

<p>By the end of today, you will be able to:
  <ol>
    <li>use the LocalStorage API to store information in the browser
      
    <li>use stored information to remember and implement a user's preferences.
      
  </ol>

  <h2>Event Binding</h2>

  <p>We've seen event binding before, when we first introduced events and
  event handlers.  There are two ways to have a function,
  say <code>fred</code>, be invoked when a button is clicked:
    <ul>
      <li>The old-fashioned, in-line way:
<pre>
&lt;button type="button" onClick="fred();"&gt;

&lt;script&gt;
  function fred () { ... }
&lt;/script&gt;

</pre>        

      <li>The new, modern, external way:

<pre>
&lt;button type="button" id="doit"&gt;

&lt;script&gt;
  function fred () { ... }

  document.querySelector("#doit").onclick = fred;
&lt;/script&gt;

</pre>        

    </ul>

    <p>(For you pedants, these are not <em>exactly</em> the same, but for
    our purposes they are.)

    <p>Advantages of the new way:
      <ul>
        <li>JavaScript code is kept entirely separate from the HTML
          
        <li>The event handler can easily be attached (<em>bound</em>) to
        multiple elements.  For example, we could attach one to every item
        in an HTML list like this:
<pre class="prettyprint lang-js">
var elts = document.querySelectorAll("#mylist > li");
for( var i=0; i < elts.length; i++ ) {
    var li_elt = elts[i];
    li_elt.onclick = fred;
}                  
</pre>          
      </ul>

      <p>List of reasons:
        <ol type="A">
          <li><p>cool
            
          <li><p>shiny
            
          <li><p>new
            
          <li><p>modern
        </ol>

      <p>The fancy feature where I can click on a quiz answer and make it
      disappear is done using event binding and a kind of compact notation
      like that loop above. If I only had inline event handlers, it would
      be so tedious that I simply wouldn't do it.  With event binding,
      it's automagic.

   <h2>Local Storage Concept Review</h2> 
          
   <p>Local Storage is a departure from most of our JavaScript because we
   are interacting with something <em>outside</em> the little world of
   JavaScript and the document.

   <p>Furthermore, it can be weird and hard to debug because restarting
   the browser doesn't <q>reset</q> everything. Before in this course, you
   could always <q>start over</q> by reloading the page, but no
   longer. That's because local storage is <em>sticky</em>.

     <p>
       <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>Method/<br>Property</th>
                <th>Usage Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>.length</code></td>
                <td><code>localStorage.length</code><br>
                 The number of items stored in the storage.
                </td>
              </tr>
              <tr>
                <td><code>.setItem()</code></td>
                <td><code>localStorage.setItem("zip", "02481")</code><br>
                Stores an item as a pair of a key and value.
                </td>
              </tr>
              <tr>
                <td><code>.getItem()</code></td>
                <td><code>localStorage.getItem("zip")</code><br>
                Retrieves the value stored under the key that is passed as 
                an argument to the method.
                </td>
              </tr>
              <tr>
                <td><code>.clear()</code></td>
                <td><code>localStorage.clear()</code><br>
                Removes all items stored in the local storage.
                </td>
              </tr>
              <tr>
                <td><code>.removeItem()</code></td>
                <td><code>localStorage.removeItem("zip")</code><br>
                Removes only one item, whose key is passed as the argument.
                </td>
              </tr> 
              <tr>
                <td><code>.key()</code></td>
                <td><code>localStorage.key(1)</code><br>
                Retrieves the name of the key with index 1 (imagine that keys are
                stored in a array and we can access each of them through the index).
                </td>
              </tr>              
            </tbody>
          </table>


    <h2>Quiz Question Nr. 1</h2> 

    <p>The JavaScript on a page executes the following code:
<pre class="prettyprint lang-js">
  var year = localStorage.getItem("year");
</pre>
<p>What value does <code>year</code> have?
    <ol type="A">
        <li>the number 2014</li>
        <li>the string "2014"</li>
        <li>undefined</li>
        <li>it depends on what was previously stored, if anything</li>
    </ol>
          
    <h2>Quiz Question Nr. 2</h2> 

    <p>We want to keep a visits counter on a page, so we write the
    following code, but it doesn't do the right thing. Why not?
      <pre class="prettyprint lang-js">
        var numPrior = localStorage.getItem("numPriorVisits");
        var numPrior = numPrior + 1;
        localStorage.setItem("numPriorVisits", numPrior);
      </pre>
      
    <ol type="A">
        <li>the method to store a value is called <code>putItem</code></li>
        <li>We need to set the item <em>before</em> we get it</li>
        <li>We need to use <code>parseInt</code> on the value</li>
        <li>We need to <code>.clear()</code> the localStorage first</li>
    </ol>
          
  <h2>Quiz Question Nr. 3</h2> 
  <p>LocalStorage is a lot like using global variables except ...
    <ol type="A">
        <li>global variables disappear when the browser tab is closed</li>
        <li>local storage has a fixed length</li>
        <li>local storage is local to a single function</li>
        <li>local storage has to be initialized before it can be used</li>
    </ol>

  <h2>Quiz Question Nr. 4</h2> 

<p>Suppose we have a <code>DIV</code> on the page like this:
  <pre class="prettyprint lang-html">
    &lt;div id="fred"&gt; ... &lt;div&gt;
  </pre>

<p>We want to have the <code>doStuff</code> function executed whenever
  Fred is clicked on.  How can we do that?

    <ol type="A">
        <li>rewrite the div to be
  <pre class="prettyprint lang-html">
    &lt;div id="fred" onclick="doStuff" &gt; ... &lt;div&gt;
  </pre>
  <li>rewrite the div to be
  <pre class="prettyprint lang-html">
    &lt;div id="fred" onclick="doStuff();" &gt; ... &lt;div&gt;
  </pre>
  <li>In our JS code, do this:
<pre class="prettyprint lang-js">
  document.querySelector("#fred").onclick = doStuff();
</pre>    
  <li>In our JS code, do this:
<pre class="prettyprint lang-js">
  document.querySelector("#fred").onclick = doStuff;
</pre>    
    </ol>

 <h2>Saving User Preferences</h2>

<p>For accessiblity reasons, many professional websites have a way to
  increase or decrease the font size.  We're going to do that.

<p>First, try the following
  <blockquote>
    <p><a target="_blank" href="fontsize.html">example of setting the font size</a>
</blockquote>

<p>Let's look at the code:
   <pre class="prettyprint lang-js linenums">
var fontSize=12;  // in px

function changeFontSize(diff) {
    fontSize = fontSize + diff;
    document.body.style.fontSize=fontSize+"px";
    console.log("font set to "+fontSize);
}

function increase() {
    console.log("increasing");
    changeFontSize(+1);
}

function decrease() {
    console.log("decreasing");
    changeFontSize(-1);
}

function setup() {
    console.log("set up");
    changeFontSize(0);
    document.querySelector('#bigger').onclick = increase;
    document.querySelector('#smaller').onclick = decrease;
}

window.onload = setup;

// to work in jsFiddle, we need to invoke setup() ourselves, since there 
// is no "window" object (our code is inside the panes of jsFiddle).
  </pre>

<p>What questions do you have?

<h2>Exercise 1</h2>

<div class="alert alert-danger">          
<p>Open the <a href="http://jsfiddle.net/nun30Lk5/" target="_blank">jsFiddle</a>.</p>
</div>
<p>Alternatively: </p>          
<p>Download the following files to your computer:
<ul>
  <li><a href="fontsize.html">fontsize.html</a>
  <li><a href="fontsize.js">fontsize.js</a>
</ul>

<p>Do the following
<ol>
  <li>Make sure the downloaded file works correctly. (if using the files)

  <li>Figure out how to save the desired font size in the local storage.
    
  <li>Figure out when that should happen.
    
  <li>Implement the saving of the font size.

  <li>Check in the browser inspector to see if this worked.
    
  <li>When the setup happens, read the saved font size (if any).  Remember
  that <code>getItem</code> returns <code>null</code> if there is no
  value.
    
  <li>Set the font size to that saved value.
</ol>

<p>Your solution might work like this:
  <blockquote>
    <p><a  target="_blank"  href="fontsize-stored.html">example of setting and storing the font size</a>
</blockquote>

<h2>Summary</h2>

<p>We hope that after these activities you have a good understanding of:
  <ul>

    <li>how to save values in local storage
    <li>how to read values from local storage
    <li>how to set up event handlers
  </ul>

      </div><!-- end of row -->
    </div><!-- end of class=container -->



    <!--#include virtual="../../modularity/bs-footer.part" -->
    <script src="../../js/TOC.js"></script>
    <script src="/~cs307/js/google-code-prettify/prettify.js"></script>
    <script>insertTOC_textual(); prettyPrint();</script>
    <script>
      function hideAnswer() {
          $("pre",this)
              .css('border-color','red')
              .css('background-color','#FF8080')
              .fadeOut(1000);
          $("p",this)
              .css('border-color','red')
              .css('background-color','#FF8080')
              .fadeOut(1000);
      }

      $("ol[type='A'] > li").click(hideAnswer);
    </script>
   </div>
  </div>
  <!--#include virtual="/~cs110/modularity/footer.part" -->
 </div> <!--end of container>
        
        
 <!--#include virtual="/~cs110/modularity/bs-footer.part" -->
  </body>
</html>
