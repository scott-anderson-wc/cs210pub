<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Activities</title>
    <!--#include virtual="../../modularity/bs-head.part" -->
    <link rel="stylesheet" type="text/css" href="http://cs.wellesley.edu/~cs307/js/google-code-prettify/prettify-sda.css">
  <script src="http://google-code-prettify.googlecode.com/svn/loader/prettify.js"></script>
  <link rel="stylesheet" href="prettify.css">
    <style>
      #TOC_list {list-style-type: none;}
    </style>
    
  </head>
  <body>
    <!--#include virtual="../../modularity/navbar.part" -->

    <div class="container">
      <h1>User-defined Functions</h1>
      <hr>
    </div>
      
    <div class="container">
      <div class="row">
     
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">  
              <div id="insert_TOC_here"></div>
            </ul>
          </div>
        </div>

        <div class="col-md-8">
          
<div class="alert alert-danger">
  We will initially complete some of the activities from the 
  <a href="activities.html">previous lecture</a>
</div>
<hr>
<h2>Goal</h2>

<p>By the end of today, you'll have had some experience with using loops
  to process simple lists of numbers. You'll see how functions and event
  handlers can make for pages with interactive sound playing. We'll also
  have a fun Halloween game.

<h2>The Sound Playing Example</h2>

<p>First, let's all play with the

<a href="/~cs110/documentation/js-examples/play_audio.html"
   target="_blank">example that uses a Javascript function to add an
audio element</a> on the fly to a page. 

<p>Observations:
<ul>
  <li>The page initially has four paragraphs, each with a word, an icon
  and an audio element.
  <li>The function <code>onDocumentReady</code> sets up the page, adding
  an <code>onclick</code> event handler to each icon
    
  <li>The event handler looks to the siblings of its parent for
  information and abilities.
</ul>

<h2>Alternative playSound</h2>

<p>The <code>playSound</code> function is pretty complicated. Here's a
  simpler version:

<pre class="prettyprint lang-js">  
function playSound() {

  console.log(this) // Check that it refers to the &lt;img&gt; element

  var word = this.previousSibling.innerHTML;
  var audio = this.nextSibling;
  audio.setAttribute("type","audio/mpeg");
  audio.setAttribute("autoplay","autoplay");
  var url = "https://ssl.gstatic.com/dictionary/static/sounds/de/0/" + word + ".mp3";
  audio.setAttribute("src",url);
}
  </pre>

<h2>Quiz Question Nr. 1</h2> 
<p>Below is the structure of each paragraph in the page:</p>          
<pre class="prettyprint">
&lt;p&gt;&lt;span&gt;apple&lt;/span&gt;&lt;img src="icons/play.png" alt="sound icon"&gt;&lt;audio&gt;&lt;/audio&gt;&lt;/p&gt;
</pre>
<p>What would happen if we rearranged some of the elements in each paragraph,
  such as putting the audio element before the icon?
  <ol type="A">
    <li>The code would be fine
    <li>The code would break because <code>this</code> would have the
    wrong value
    <li>The code would break because <code>playSound</code> would not get invoked.
    <li>The code would break because the siblings of <code>this</code>
    would be different elements.
  </ol>

<p>Let's consider alternative ways to do a page like this
  
<h2>Quiz Question Nr. 2</h2> 

<p>Is it possible to make the words clickable instead of the icons?
  <ol type="A">
    <li>yes, if we can get the right selector to get a list of the <code>span</code> elements
    <li>yes, if we can get event handler for them
    <li>no, only the image icons can be clickable
    <li>no, because it needs to be next to the audio element.
  </ol>

<h2>Quiz Question Nr. 3</h2> 

<p>Do we need four audio elements?
  <ol type="A">
    <li>yes, we need a different one for each word
    <li>yes, because the audio element needs to be in the same paragraph
    as the word
    <li>no, because we're setting the src to a URL that depends on the word
    <li>no, but we do need more than one audio element.
  </ol>

<h2>Happy Halloween</h2>

<p>Eni has built, for our chilly delight,
a very cool <a href="halloween.html">Halloween-themed game</a>.

<p>Let's look at the materials of the game, starting with
  the <a href="spooky/">game images</a>

<p>Next, a quick look at the important CSS:
<pre class="prettyprint lang-css linenums">
    div {float: left; 
         width: 100px;
         height: 100px;
      border: 1px red solid;
      margin: 2px;
    }
    div img {width: 100px; visibility: hidden;}
    div.shown img { visibility: visible; }
</pre>  

<p>So, any <code>img</code> inside a <code>div</code> is hidden, but we
  can make it visible by adding the <code>shown</code> class to
  the <code>div</code>.

<h2>Halloween Code</h2>

<p>Now it's time to understand the code.

<p>Let's look at some of the functions, in turn.  The first prepares the
  game board by hiding some images in randomly selected cells:
  
<pre class="prettyprint lang-js linenums">
function prepare_game() {
    var cellsCount = create_grid();
    
    // randomly select the number of total images
    var filesCount = fileNames.length;
    var imageLimit = Math.min(filesCount,cellsCount);
    var totalImages = Math.floor(Math.random()*imageLimit);
    document.querySelector("#total").innerHTML = totalImages;
    document.querySelector("#found").innerHTML = foundByUser;
    // randomly select the image indices
    var imageIdxArr = getArrayRandomNumbers(totalImages, filesCount);
    // randomly select the div indices to hold the images
    var divIdxArr = getArrayRandomNumbers(totalImages, cellsCount);
    
    setImages(imageIdxArr, divIdxArr);
}
</pre>  

<h2>Quiz Question Nr. 4</h2> 

<p>Which of the following is okay?
  <ol type="A">
    <li>swapping lines 5 and 6
    <li>swapping lines 6 and 7
    <li>swapping lines 7 and 8
    <li>swapping lines 8 and 9
  </ol>

<p>The <code>create_grid</code> function creates all the cells (as many as
  it can, depending on how big our window is), and tells us (by returning
  a value) how many cells there are.

<p>It then chooses a random number (within limits) for the number of
  images to hide.  This is stored in <code>totalImages</code>.

<p>Suppose that <code>totalImages</code> is a number like 3. The last two
  lines pick 3 images out of the set of 41 creepy images and pick 3 cells
  out of the grid (however many there turn out to be), to put the 3 images
  into.

<p>Let's look at that next:

  <pre class="prettyprint lang-js linenums">
function setImages(imgArr, divArr) {
    console.log("inside setImages");
    if( imgArr.length != divArr.length ) {
        console.log("something has gone wrong: array lengths don't match");
        return;
    }
    for (var i=0; i < imgArr.length; i++) {
        var imgIdx = imgArr[i];
        var divId = divArr[i];
        setOneImage(imgIdx, divId);
    }
}
  </pre>

<p>This is pretty much our standard loop. All the interesting work is in
  the <code>setOneImage</code> function:

<pre class="prettyprint lang-js linenums">
  function setOneImage(imageIndex, divId) {
    console.log("image "+imageIndex+" will go in cell "+divId);
    var div = document.querySelector("#i_"+divId);
    var imgEl = document.createElement("img");
    var filename = fileNames[imageIndex];
    imgEl.setAttribute("src", "spooky/"+filename+".png");
    imgEl.setAttribute("alt", filename);
    div.appendChild(imgEl);
    div.onclick = showImage;
}
</pre>  

<p>This function creates an image element, sets the <code>src</code>
  depending on the <code>imageIndex</code> and puts the image into the div
  with the id given by <code>divId</code>.

<p>By having this as a separate function, we can test it by hand. Let's do
  that!  Open up a console and reload the page a few times until you get a
  small number of images, so there are lots of empty cells. The JS console
  will tell you which cells are in use, so you can play a perfect game if
  you want.  But suppose cells 0, 1 and 2 are empty.  Do this:
  <pre class="prettyprint lang-js linenums">
setOneImage(30,0);
setOneImage(30,1);
setOneImage(30,2);
</pre>

<p>That puts the same image in all three cells. Now, click on those cells.

<p>Now, let's look at what happens when you click on a cell:

  <pre class="prettyprint lang-js linenums">
function showImage() {
    // find div that was clicked to show in console
    var divId = this.getAttribute("id");
    console.log("Found "+divId);
    // alert("Found you!");
    this.classList.add("shown"); // makes the image visible
    foundByUser += 1;
    document.querySelector("#found").innerHTML = foundByUser;
}
</pre>

<p>Here's where we use the CSS trick to make the hidden image visible. 


<h2>Quiz Question Nr. 5</h2> 

<p>How could we cheat and get the page to say "Found 10 out of 9"
  <ol type="A">
    <li><pre class="prettyprint lang-js">
    document.querySelector("#found").innerHTML = "10 of 9";
      </pre>
    <li><pre class="prettyprint lang-js">
    document.querySelector("#total").innerHTML = "10 of 9";
      </pre>
    <li><pre class="prettyprint lang-js">
    document.querySelector("#total").innerHTML = 9;
    document.querySelector("#found").innerHTML = 10;
      </pre>
    <li><pre class="prettyprint lang-js">
    document.querySelector("#total").innerHTML = 10;
    document.querySelector("#found").innerHTML = 9;
      </pre>
  </ol>

<h2>Summary</h2>

<p>We hope that after these activities you have a good understanding of:
  <ul>

    <li>connecting the JavaScript ideas and techniques to the making
    interactive web pages.
      
    <li>how to use the JavaScript console to test pieces of code
      
    <li>how to use your knowledge of JavaScript to cheat at games
  </ul>

      </div><!-- end of row -->
    </div><!-- end of class=container -->



    <!--#include virtual="../../modularity/bs-footer.part" -->
    <script src="../../js/TOC.js"></script>
    <script src="/~cs307/js/google-code-prettify/prettify.js"></script>
    <script>insertTOC_textual(); prettyPrint();</script>
    <script>
      function hideAnswer() {
          $("pre",this)
              .css('border-color','red')
              .css('background-color','#FF8080')
              .fadeOut(1000);
          $("p",this)
              .css('border-color','red')
              .css('background-color','#FF8080')
              .fadeOut(1000);
      }

      $("li").click(hideAnswer);
    </script>
   </div>
  </div>
  <!--#include virtual="/~cs110/modularity/footer.part" -->
 </div> <!--end of container>
        
        
 <!--#include virtual="/~cs110/modularity/bs-footer.part" -->
  </body>
</html>
